<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Page</title>
  <style>
    html {
        overflow: hidden;
        height: 100%;
    }
    
    body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
        margin: 0; 
        padding: 0; 
        background-color: #fafafa; 
        height: 100vh;
        overflow: hidden;
        position: relative;
    }
    
    .bg-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
    }
    
    .bg-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    .bg-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(220, 53, 69, 0.04) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(40, 167, 69, 0.04) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.02) 0%, transparent 60%);
        pointer-events: none;
        z-index: 1;
        animation: shimmer 10s ease-in-out infinite;
    }
    
    @keyframes shimmer {
        0%, 100% {
            opacity: 0.4;
        }
        50% {
            opacity: 0.8;
        }
    }
    
    .my-gifts-btn, .logout-btn {
        position: fixed;
        top: clamp(0.75rem, 2vw, 1rem);
        z-index: 1000;
        color: white;
        text-decoration: none;
        padding: clamp(0.5rem, 1.5vw, 0.625rem) clamp(0.75rem, 2vw, 1rem);
        border: 2px solid rgba(220, 53, 69, 0.6);
        border-radius: clamp(0.5rem, 1.2vw, 0.75rem);
        font-size: clamp(0.875rem, 2vw, 1rem);
        transition: all 0.3s ease;
        font-weight: 600;
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.85), rgba(200, 35, 51, 0.85));
        backdrop-filter: blur(8px);
        box-shadow: 
            0 2px 8px rgba(0, 0, 0, 0.4),
            0 0 15px rgba(220, 53, 69, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        width: 15%;
        max-width: 6vw;
        max-height: 6vw;
        min-width: 40px;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        white-space: nowrap;
    }
    
    .logout-btn {
        right: clamp(1rem, 4vw, 1.25rem);
    }
    
    .my-gifts-btn {
        /* 确保 my-gifts-btn 永远在 logout-btn 的左边，不重叠 */
        /* logout-btn 的 right: clamp(1rem, 4vw, 1.25rem) + max-width: 6vw + 间距 */
        /* 所以 my-gifts-btn 的 right 至少需要: 1.25rem + 6vw + 1rem = 约 2.25rem + 6vw */
        /* 为了安全，使用更大的值: clamp(8rem, 18vw, 12rem) */
        right: clamp(8rem, 18vw, 12rem);
    }
    
    .my-gifts-btn:hover, .logout-btn:hover {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.95), rgba(200, 35, 51, 0.95));
        border-color: rgba(255, 215, 0, 0.8);
        transform: translateY(-2px);
        box-shadow: 
            0 4px 12px rgba(0, 0, 0, 0.5),
            0 0 25px rgba(255, 215, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
    
    main {
        padding: clamp(3rem, 8vw, 5rem) clamp(1rem, 4vw, 2.5rem) clamp(2rem, 8vw, 4rem);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
        position: relative;
        padding-top: clamp(8vh, 12vw, 15vh);
        z-index: 100;
        pointer-events: none;
    }
    
    main * {
        pointer-events: auto;
    }
    
    .button-image-1,
    .button-image-2,
    .bg-container .element.button-image-1,
    .bg-container .element.button-image-2 {
        width: 20%;
        max-width: 20vw;
        height: auto;
        min-width: 120px;
        object-fit: contain;
        cursor: pointer;
        transition: 
            transform 0.1s cubic-bezier(0.4, 0, 0.2, 1),
            opacity 0.3s ease,
            visibility 0.3s ease;
        opacity: 0;
        visibility: hidden;
        filter: drop-shadow(0 4px 15px rgba(0, 0, 0, 0.4));
        will-change: transform, filter;
        transform-origin: center center;
        position: absolute;
        pointer-events: auto;
        z-index: 998;
        display: block;
        text-decoration: none;
    }
    
    .button-image-1 img,
    .button-image-2 img,
    .bg-container .element.button-image-1 img,
    .bg-container .element.button-image-2 img {
        width: 100%;
        height: auto;
        display: block;
        object-fit: contain;
    }
    
    .button-image-1.positioned,
    .button-image-2.positioned,
    .bg-container .element.button-image-1.positioned,
    .bg-container .element.button-image-2.positioned {
        opacity: 0.8;
        visibility: visible;
    }
    
    .button-image-1,
    .bg-container .element.button-image-1 {
        /* left 和 top 由 JavaScript 动态计算 */
        transform: translate(-50%, -50%) scale(1.8);
    }
    
    .button-image-2,
    .bg-container .element.button-image-2 {
        /* left 和 top 由 JavaScript 动态计算 */
        transform: translate(-50%, -50%) scale(1.8);
    }
    
    .button-image-1:hover,
    .bg-container .element.button-image-1:hover {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1.8) translateY(-5px);
        filter: drop-shadow(0 8px 20px rgba(255, 215, 0, 0.7)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
    }
    
    .button-image-2:hover,
    .bg-container .element.button-image-2:hover {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1.8) translateY(-5px);
        filter: drop-shadow(0 8px 20px rgba(255, 215, 0, 0.7)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
    }
    
    /* 响应式设计 - 移动设备 */
    @media (max-width: 768px) {
        main {
            padding: clamp(2.5rem, 8vw, 4rem) clamp(1rem, 4vw, 2rem) clamp(2rem, 8vw, 3rem);
            padding-top: clamp(6vh, 10vw, 12vh);
        }
        
        .button-image-1,
        .button-image-2,
        .bg-container .element.button-image-1,
        .bg-container .element.button-image-2 {
            min-width: 120px;
        }
    }
    
    /* 响应式设计 - 小屏幕设备 */
    @media (max-width: 480px) {
        main {
            padding: clamp(1.5rem, 6vw, 3rem) clamp(0.75rem, 3vw, 1.5rem);
            justify-content: flex-start;
            padding-top: clamp(5vh, 10vw, 10vh);
        }
        
        .my-gifts-btn, .logout-btn {
            min-width: 35px;
            min-height: 35px;
            font-size: clamp(0.75rem, 3vw, 0.875rem);
            padding: clamp(0.4rem, 2vw, 0.5rem) clamp(0.6rem, 3vw, 0.75rem);
        }
        
        .my-gifts-btn {
            min-width: clamp(70px, 15vw, 100px);
            padding: clamp(0.4rem, 2vw, 0.5rem) clamp(0.8rem, 2.5vw, 1.2rem);
        }
        
        .button-image-1,
        .button-image-2,
        .bg-container .element.button-image-1,
        .bg-container .element.button-image-2 {
            min-width: 100px;
        }
    }
  </style>
</head>
<body>
  <!-- My Gifts and Logout Buttons -->
  {% if session.username %}
    <a href="{{ url_for('main.talent_records') }}" class="my-gifts-btn">My Gifts</a>
    <a href="{{ url_for('user.logout') }}" class="logout-btn">Logout</a>
  {% endif %}

  <div class="bg-container">
      <img src="{{ url_for('static', filename='background/board_no_text.png') }}" class="bg-img" alt="background">
      
      {% if session.username %}
      <a href="{{ url_for('main.draw_self') }}" class="element button-image-1">
          <img src="{{ url_for('static', filename='draw_home_buttons/' + session.username + '.png') }}" alt="Draw for Self">
      </a>
      <a href="{{ url_for('main.draw_others') }}" class="element button-image-2">
          <img src="{{ url_for('static', filename='draw_home_buttons/draw_for_others.png') }}" alt="Draw for Others">
      </a>
      {% endif %}
  </div>

  <main>
      <!-- Content goes here -->
  </main>
  
  <script>
    // 背景图配置
    const bgConfig = {
      originalWidth: 3840, 
      originalHeight: 2160, 
      imageUrl: "{{ url_for('static', filename='background/board_no_text.png') }}"
    };
    
    // 元素位置配置
    // targetX/targetY: 元素在背景图上的坐标（像素）
    // anchorX/anchorY: 元素的锚点 (0=左上, 0.5=中心, 1=右下)
    const elementPositions = [
      {
        selector: '.element.button-image-1',
        targetX: 2300, // ⬅️ 修改这个值调整第一张图片的X位置
        targetY: 900,  // ⬅️ 修改这个值调整第一张图片的Y位置
        anchorX: 0.5,
        anchorY: 0.5
      },
      {
        selector: '.element.button-image-2',
        targetX: 2300, // ⬅️ 修改这个值调整第二张图片的X位置
        targetY: 1500,  // ⬅️ 修改这个值调整第二张图片的Y位置
        anchorX: 0.5,
        anchorY: 0.5
      }
    ];
    
    // 计算元素在 cover 模式下的位置
    function calculateElementPosition(element, targetX, targetY, anchorX, anchorY) {
      const container = document.querySelector('.bg-container');
      if (!container || !element) return;
      
      // 确保元素已经渲染
      if (element.offsetWidth === 0 || element.offsetHeight === 0) {
        // 如果元素还没有尺寸，延迟计算（最多重试3次）
        const retryCount = parseInt(element.dataset.positionRetry || '0');
        if (retryCount < 3) {
          element.dataset.positionRetry = String(retryCount + 1);
          setTimeout(() => calculateElementPosition(element, targetX, targetY, anchorX, anchorY), 50);
        } else {
          // 如果重试3次仍然没有尺寸，强制显示元素（位置可能不准确，但至少可见）
          element.classList.add('positioned');
        }
        return;
      }
      
      // 清除重试计数
      if (element.dataset.positionRetry) {
        delete element.dataset.positionRetry;
      }
      
      const containerWidth = container.offsetWidth;
      const containerHeight = container.offsetHeight;
      
      if (containerWidth === 0 || containerHeight === 0) return;
      
      // 计算背景图的宽高比
      const bgAspectRatio = bgConfig.originalWidth / bgConfig.originalHeight;
      const containerAspectRatio = containerWidth / containerHeight;
      
      let displayWidth, displayHeight, offsetX = 0, offsetY = 0;
      
      // 计算 cover 模式下的实际显示尺寸和偏移
      if (bgAspectRatio > containerAspectRatio) {
        // 背景图宽度填满，高度被裁剪（上下有黑边）
        displayHeight = containerHeight;
        displayWidth = displayHeight * bgAspectRatio;
        offsetX = (displayWidth - containerWidth) / 2;
      } else {
        // 背景图高度填满，宽度被裁剪（左右有黑边）
        displayWidth = containerWidth;
        displayHeight = displayWidth / bgAspectRatio;
        offsetY = (displayHeight - containerHeight) / 2;
      }
      
      // 计算目标点在容器中的实际位置
      const targetPixelX = (targetX / bgConfig.originalWidth) * displayWidth - offsetX;
      const targetPixelY = (targetY / bgConfig.originalHeight) * displayHeight - offsetY;
      
      // 获取元素的原始尺寸（不考虑 transform）
      const elementWidth = element.offsetWidth;
      const elementHeight = element.offsetHeight;
      
      // 检查元素是否有 translate(-50%, -50%) 的 transform
      const computedStyle = window.getComputedStyle(element);
      const transform = computedStyle.transform;
      let hasTranslateCenter = false;
      
      if (transform && transform !== 'none') {
        // 检查是否包含 translate(-50%, -50%)
        if (transform.includes('translate(-50%') || transform.includes('translate(-50%')) {
          hasTranslateCenter = true;
        }
      }
      
      // 计算元素的左上角位置（考虑锚点和 transform）
      let elementLeft, elementTop;
      
      if (hasTranslateCenter) {
        // 如果元素有 translate(-50%, -50%)，元素中心会对齐到目标点
        // 所以直接设置目标点位置，transform 会自动居中
        elementLeft = targetPixelX;
        elementTop = targetPixelY;
      } else {
        // 正常计算，考虑锚点
        elementLeft = targetPixelX - (elementWidth * anchorX);
        elementTop = targetPixelY - (elementHeight * anchorY);
      }
      
      // 应用位置
      element.style.left = elementLeft + 'px';
      element.style.top = elementTop + 'px';
      
      // 标记元素已定位，显示元素
      element.classList.add('positioned');
    }
    
    // 更新所有元素位置
    function updateAllElementPositions() {
      elementPositions.forEach(config => {
        const elements = document.querySelectorAll(config.selector);
        elements.forEach(element => {
          calculateElementPosition(
            element,
            config.targetX,
            config.targetY,
            config.anchorX,
            config.anchorY
          );
        });
      });
    }
    
    // 防抖函数
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // 创建防抖版本的位置更新函数
    const debouncedUpdatePositions = debounce(updateAllElementPositions, 100);
    
    // 确保 my-gifts-btn 和 logout-btn 不重叠
    function adjustButtonPositions() {
      const logoutBtn = document.querySelector('.logout-btn');
      const myGiftsBtn = document.querySelector('.my-gifts-btn');
      
      if (logoutBtn && myGiftsBtn) {
        // 获取 logout-btn 的位置和宽度
        const logoutRect = logoutBtn.getBoundingClientRect();
        const logoutRight = window.innerWidth - logoutRect.right; // logout-btn 距离右边的距离（px）
        const logoutWidth = logoutRect.width; // logout-btn 的宽度（px）
        
        // 获取 my-gifts-btn 的宽度
        const myGiftsBtnRect = myGiftsBtn.getBoundingClientRect();
        const myGiftsBtnWidth = myGiftsBtnRect.width; // my-gifts-btn 的宽度（px）
        
        // 计算 my-gifts-btn 应该的 right 值（像素）
        // 需要确保 my-gifts-btn 的右边缘在 logout-btn 的左边缘左边，并留出间距
        const spacing = 16; // 16px 的间距（约 1rem）
        const myGiftsBtnRight = logoutRight + logoutWidth + spacing;
        
        // 设置 my-gifts-btn 的 right 值（使用像素值，更精确）
        myGiftsBtn.style.right = myGiftsBtnRight + 'px';
      }
    }
    
    // 创建防抖版本的按钮位置调整函数
    const debouncedAdjustButtons = debounce(adjustButtonPositions, 100);
    
    // 初始位置计算（快速计算，不等待图片加载）
    function calculateInitialPositions() {
      // 使用配置的默认尺寸快速计算位置
      const bgImg = document.querySelector('.bg-img');
      if (bgImg && bgImg.naturalWidth > 0) {
        // 如果背景图已加载，使用实际尺寸
        bgConfig.originalWidth = bgImg.naturalWidth || bgConfig.originalWidth;
        bgConfig.originalHeight = bgImg.naturalHeight || bgConfig.originalHeight;
      }
      // 否则使用配置中的默认尺寸
      
      // 立即计算并显示元素位置
      updateAllElementPositions();
    }
    
    // 等待 DOM 加载完成
    document.addEventListener('DOMContentLoaded', function() {
      // 立即计算初始位置（不等待图片加载）
      // 使用 requestAnimationFrame 确保 DOM 已渲染
      requestAnimationFrame(function() {
        setTimeout(calculateInitialPositions, 0);
        // 调整按钮位置，确保不重叠
        setTimeout(adjustButtonPositions, 50);
      });
      
      // 如果背景图稍后加载完成，更新尺寸（但不再重新计算位置）
      const bgImg = document.querySelector('.bg-img');
      if (bgImg && !bgImg.complete) {
        bgImg.addEventListener('load', function() {
          // 更新配置中的实际尺寸，供 resize 时使用
          bgConfig.originalWidth = bgImg.naturalWidth || bgConfig.originalWidth;
          bgConfig.originalHeight = bgImg.naturalHeight || bgConfig.originalHeight;
          // 如果窗口大小已改变，重新计算一次
          if (window.innerWidth !== window.initialWidth || window.innerHeight !== window.initialHeight) {
            debouncedUpdatePositions();
          }
          // 调整按钮位置
          adjustButtonPositions();
        }, { once: true });
      }
      
      // 记录初始窗口尺寸
      window.initialWidth = window.innerWidth;
      window.initialHeight = window.innerHeight;
      
      // 只在窗口大小变化时重新计算位置
      window.addEventListener('resize', function() {
        debouncedUpdatePositions();
        debouncedAdjustButtons();
      });
    });
  </script>
</body>
</html>

