<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Page</title>
  <style>
    html {
        overflow: hidden;
        height: 100%;
    }
    
    body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
        margin: 0; 
        padding: 0; 
        background-color: #fafafa; 
        height: 100vh;
        overflow: hidden;
        position: relative;
    }
    
    .bg-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
    }
    
    .bg-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    .bg-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(220, 53, 69, 0.04) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(40, 167, 69, 0.04) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.02) 0%, transparent 60%);
        pointer-events: none;
        z-index: 1;
        animation: shimmer 10s ease-in-out infinite;
    }
    
    @keyframes shimmer {
        0%, 100% {
            opacity: 0.4;
        }
        50% {
            opacity: 0.8;
        }
    }
    
    .my-gifts-btn, .logout-btn {
        position: fixed;
        top: clamp(0.75rem, 2vw, 1rem);
        z-index: 1000;
        color: white;
        text-decoration: none;
        padding: clamp(0.5rem, 1.5vw, 0.625rem) clamp(0.75rem, 2vw, 1rem);
        border: 2px solid rgba(220, 53, 69, 0.6);
        border-radius: clamp(0.5rem, 1.2vw, 0.75rem);
        font-size: clamp(0.875rem, 2vw, 1rem);
        transition: all 0.3s ease;
        font-weight: 600;
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.85), rgba(200, 35, 51, 0.85));
        backdrop-filter: blur(8px);
        box-shadow: 
            0 2px 8px rgba(0, 0, 0, 0.4),
            0 0 15px rgba(220, 53, 69, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        max-height: 6vw;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        white-space: nowrap;
    }
    
    .my-gifts-btn {
        right: clamp(7rem, 15vw, 10rem);
        width: auto;
        min-width: clamp(80px, 12vw, 120px);
        padding: clamp(0.5rem, 1.5vw, 0.625rem) clamp(1rem, 2.5vw, 1.5rem);
    }
    
    .logout-btn {
        right: clamp(1rem, 4vw, 1.25rem);
        width: 15%;
        max-width: 6vw;
        min-width: 40px;
    }
    
    .my-gifts-btn:hover, .logout-btn:hover {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.95), rgba(200, 35, 51, 0.95));
        border-color: rgba(255, 215, 0, 0.8);
        transform: translateY(-2px);
        box-shadow: 
            0 4px 12px rgba(0, 0, 0, 0.5),
            0 0 25px rgba(255, 215, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
    
    main {
        padding: clamp(3rem, 8vw, 5rem) clamp(1rem, 4vw, 2.5rem) clamp(2rem, 8vw, 4rem);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
        position: relative;
        padding-top: clamp(8vh, 12vw, 15vh);
        z-index: 100;
        pointer-events: none;
    }
    
    main * {
        pointer-events: auto;
    }
    
    .welcome-title {
        margin-bottom: clamp(1.5rem, 4vw, 2.5rem);
        font-size: clamp(1.75rem, 5vw, 3rem);
        font-weight: 700;
        text-align: center;
        background: linear-gradient(135deg, #dc3545 0%, #ffc107 25%, #28a745 50%, #ffc107 75%, #dc3545 100%);
        background-size: 200% auto;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: shimmer 3s linear infinite;
        text-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
        position: relative;
        padding: clamp(0.5rem, 1.5vw, 1rem);
        width: 100%;
        max-width: min(90vw, 1200px);
        pointer-events: none;
    }
    
    .welcome-title::before {
        content: 'âœ¨';
        position: absolute;
        left: clamp(-5%, -2rem, -8%);
        top: 20%;
        font-size: clamp(1rem, 3vw, 2rem);
        animation: twinkle 2s ease-in-out infinite;
        pointer-events: none;
    }
    
    .welcome-title::after {
        content: 'âœ¨';
        position: absolute;
        right: clamp(-5%, -2rem, -8%);
        top: 20%;
        font-size: clamp(1rem, 3vw, 2rem);
        animation: twinkle 2s ease-in-out infinite 1s;
        pointer-events: none;
    }
    
    @keyframes shimmer {
        0% {
            background-position: 0% center;
        }
        100% {
            background-position: 200% center;
        }
    }
    
    @keyframes twinkle {
        0%, 100% {
            opacity: 1;
            transform: scale(1);
        }
        50% {
            opacity: 0.7;
            transform: scale(1.1);
        }
    }
    
    .button-image-1,
    .button-image-2,
    .bg-container .element.button-image-1,
    .bg-container .element.button-image-2 {
        width: 20%;
        max-width: 20vw;
        height: auto;
        min-width: 120px;
        object-fit: contain;
        cursor: pointer;
        transition: 
            transform 0.1s cubic-bezier(0.4, 0, 0.2, 1),
            opacity 0.3s ease,
            visibility 0.3s ease;
        opacity: 0;
        visibility: hidden;
        filter: drop-shadow(0 4px 15px rgba(0, 0, 0, 0.4));
        will-change: transform, filter;
        transform-origin: center center;
        position: absolute;
        pointer-events: auto;
        z-index: 998;
        display: block;
        text-decoration: none;
    }
    
    .button-image-1 img,
    .button-image-2 img,
    .bg-container .element.button-image-1 img,
    .bg-container .element.button-image-2 img {
        width: 100%;
        height: auto;
        display: block;
        object-fit: contain;
    }
    
    .button-image-1.positioned,
    .button-image-2.positioned,
    .bg-container .element.button-image-1.positioned,
    .bg-container .element.button-image-2.positioned {
        opacity: 0.8;
        visibility: visible;
    }
    
    .button-image-1,
    .bg-container .element.button-image-1 {
        /* left å’Œ top ç”± JavaScript åŠ¨æ€è®¡ç®— */
        transform: translate(-50%, -50%) scale(1.8);
    }
    
    .button-image-2,
    .bg-container .element.button-image-2 {
        /* left å’Œ top ç”± JavaScript åŠ¨æ€è®¡ç®— */
        transform: translate(-50%, -50%) scale(1.8);
    }
    
    .button-image-1:hover,
    .bg-container .element.button-image-1:hover {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1.8) translateY(-5px);
        filter: drop-shadow(0 8px 20px rgba(255, 215, 0, 0.7)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
    }
    
    .button-image-2:hover,
    .bg-container .element.button-image-2:hover {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1.8) translateY(-5px);
        filter: drop-shadow(0 8px 20px rgba(255, 215, 0, 0.7)) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
    }
    
    /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨è®¾å¤‡ */
    @media (max-width: 768px) {
        main {
            padding: clamp(2.5rem, 8vw, 4rem) clamp(1rem, 4vw, 2rem) clamp(2rem, 8vw, 3rem);
            padding-top: clamp(6vh, 10vw, 12vh);
        }
        
        .welcome-title {
            font-size: clamp(1.5rem, 7vw, 2.25rem);
            margin-bottom: clamp(1.25rem, 5vw, 2rem);
        }
        
        .welcome-title::before,
        .welcome-title::after {
            display: none;
        }
        
        .button-image-1,
        .button-image-2,
        .bg-container .element.button-image-1,
        .bg-container .element.button-image-2 {
            min-width: 120px;
        }
    }
    
    /* å“åº”å¼è®¾è®¡ - å°å±å¹•è®¾å¤‡ */
    @media (max-width: 480px) {
        main {
            padding: clamp(1.5rem, 6vw, 3rem) clamp(0.75rem, 3vw, 1.5rem);
            justify-content: flex-start;
            padding-top: clamp(5vh, 10vw, 10vh);
        }
        
        .welcome-title {
            font-size: clamp(1.25rem, 6vw, 1.75rem);
            margin-bottom: clamp(1rem, 4vw, 1.5rem);
        }
        
        .welcome-title::before,
        .welcome-title::after {
            display: none;
        }
        
        .my-gifts-btn, .logout-btn {
            min-width: 35px;
            min-height: 35px;
            font-size: clamp(0.75rem, 3vw, 0.875rem);
            padding: clamp(0.4rem, 2vw, 0.5rem) clamp(0.6rem, 3vw, 0.75rem);
        }
        
        .my-gifts-btn {
            min-width: clamp(70px, 15vw, 100px);
            padding: clamp(0.4rem, 2vw, 0.5rem) clamp(0.8rem, 2.5vw, 1.2rem);
        }
        
        .button-image-1,
        .button-image-2,
        .bg-container .element.button-image-1,
        .bg-container .element.button-image-2 {
            min-width: 100px;
        }
    }
  </style>
</head>
<body>
  <!-- My Gifts and Logout Buttons -->
  {% if session.username %}
    <a href="{{ url_for('main.talent_records') }}" class="my-gifts-btn">My Gifts</a>
    <a href="{{ url_for('user.logout') }}" class="logout-btn">Logout</a>
  {% endif %}

  <div class="bg-container">
      <img src="{{ url_for('static', filename='background/board_no_text.png') }}" class="bg-img" alt="background">
      
      {% if session.username %}
      <a href="{{ url_for('main.draw_self') }}" class="element button-image-1">
          <img src="{{ url_for('static', filename='draw_home_buttons/' + session.username + '.png') }}" alt="Draw for Self">
      </a>
      <a href="{{ url_for('main.draw_others') }}" class="element button-image-2">
          <img src="{{ url_for('static', filename='draw_home_buttons/draw_for_others.png') }}" alt="Draw for Others">
      </a>
      {% endif %}
  </div>

  <main>
      {% if session.username %}
      <h1 class="welcome-title">ğŸ… Welcome, {{ session.username }} ğŸ„</h1>
      {% endif %}
  </main>
  
  <script>
    // èƒŒæ™¯å›¾é…ç½®
    const bgConfig = {
      originalWidth: 3840, 
      originalHeight: 2160, 
      imageUrl: "{{ url_for('static', filename='background/board_no_text.png') }}"
    };
    
    // å…ƒç´ ä½ç½®é…ç½®
    // targetX/targetY: å…ƒç´ åœ¨èƒŒæ™¯å›¾ä¸Šçš„åæ ‡ï¼ˆåƒç´ ï¼‰
    // anchorX/anchorY: å…ƒç´ çš„é”šç‚¹ (0=å·¦ä¸Š, 0.5=ä¸­å¿ƒ, 1=å³ä¸‹)
    const elementPositions = [
      {
        selector: '.element.button-image-1',
        targetX: 2300, // â¬…ï¸ ä¿®æ”¹è¿™ä¸ªå€¼è°ƒæ•´ç¬¬ä¸€å¼ å›¾ç‰‡çš„Xä½ç½®
        targetY: 1050,  // â¬…ï¸ ä¿®æ”¹è¿™ä¸ªå€¼è°ƒæ•´ç¬¬ä¸€å¼ å›¾ç‰‡çš„Yä½ç½®
        anchorX: 0.5,
        anchorY: 0.5
      },
      {
        selector: '.element.button-image-2',
        targetX: 2300, // â¬…ï¸ ä¿®æ”¹è¿™ä¸ªå€¼è°ƒæ•´ç¬¬äºŒå¼ å›¾ç‰‡çš„Xä½ç½®
        targetY: 1550,  // â¬…ï¸ ä¿®æ”¹è¿™ä¸ªå€¼è°ƒæ•´ç¬¬äºŒå¼ å›¾ç‰‡çš„Yä½ç½®
        anchorX: 0.5,
        anchorY: 0.5
      }
    ];
    
    // è®¡ç®—å…ƒç´ åœ¨ cover æ¨¡å¼ä¸‹çš„ä½ç½®
    function calculateElementPosition(element, targetX, targetY, anchorX, anchorY) {
      const container = document.querySelector('.bg-container');
      if (!container || !element) return;
      
      // ç¡®ä¿å…ƒç´ å·²ç»æ¸²æŸ“
      if (element.offsetWidth === 0 || element.offsetHeight === 0) {
        // å¦‚æœå…ƒç´ è¿˜æ²¡æœ‰å°ºå¯¸ï¼Œå»¶è¿Ÿè®¡ç®—ï¼ˆæœ€å¤šé‡è¯•3æ¬¡ï¼‰
        const retryCount = parseInt(element.dataset.positionRetry || '0');
        if (retryCount < 3) {
          element.dataset.positionRetry = String(retryCount + 1);
          setTimeout(() => calculateElementPosition(element, targetX, targetY, anchorX, anchorY), 50);
        } else {
          // å¦‚æœé‡è¯•3æ¬¡ä»ç„¶æ²¡æœ‰å°ºå¯¸ï¼Œå¼ºåˆ¶æ˜¾ç¤ºå…ƒç´ ï¼ˆä½ç½®å¯èƒ½ä¸å‡†ç¡®ï¼Œä½†è‡³å°‘å¯è§ï¼‰
          element.classList.add('positioned');
        }
        return;
      }
      
      // æ¸…é™¤é‡è¯•è®¡æ•°
      if (element.dataset.positionRetry) {
        delete element.dataset.positionRetry;
      }
      
      const containerWidth = container.offsetWidth;
      const containerHeight = container.offsetHeight;
      
      if (containerWidth === 0 || containerHeight === 0) return;
      
      // è®¡ç®—èƒŒæ™¯å›¾çš„å®½é«˜æ¯”
      const bgAspectRatio = bgConfig.originalWidth / bgConfig.originalHeight;
      const containerAspectRatio = containerWidth / containerHeight;
      
      let displayWidth, displayHeight, offsetX = 0, offsetY = 0;
      
      // è®¡ç®— cover æ¨¡å¼ä¸‹çš„å®é™…æ˜¾ç¤ºå°ºå¯¸å’Œåç§»
      if (bgAspectRatio > containerAspectRatio) {
        // èƒŒæ™¯å›¾å®½åº¦å¡«æ»¡ï¼Œé«˜åº¦è¢«è£å‰ªï¼ˆä¸Šä¸‹æœ‰é»‘è¾¹ï¼‰
        displayHeight = containerHeight;
        displayWidth = displayHeight * bgAspectRatio;
        offsetX = (displayWidth - containerWidth) / 2;
      } else {
        // èƒŒæ™¯å›¾é«˜åº¦å¡«æ»¡ï¼Œå®½åº¦è¢«è£å‰ªï¼ˆå·¦å³æœ‰é»‘è¾¹ï¼‰
        displayWidth = containerWidth;
        displayHeight = displayWidth / bgAspectRatio;
        offsetY = (displayHeight - containerHeight) / 2;
      }
      
      // è®¡ç®—ç›®æ ‡ç‚¹åœ¨å®¹å™¨ä¸­çš„å®é™…ä½ç½®
      const targetPixelX = (targetX / bgConfig.originalWidth) * displayWidth - offsetX;
      const targetPixelY = (targetY / bgConfig.originalHeight) * displayHeight - offsetY;
      
      // è·å–å…ƒç´ çš„åŸå§‹å°ºå¯¸ï¼ˆä¸è€ƒè™‘ transformï¼‰
      const elementWidth = element.offsetWidth;
      const elementHeight = element.offsetHeight;
      
      // æ£€æŸ¥å…ƒç´ æ˜¯å¦æœ‰ translate(-50%, -50%) çš„ transform
      const computedStyle = window.getComputedStyle(element);
      const transform = computedStyle.transform;
      let hasTranslateCenter = false;
      
      if (transform && transform !== 'none') {
        // æ£€æŸ¥æ˜¯å¦åŒ…å« translate(-50%, -50%)
        if (transform.includes('translate(-50%') || transform.includes('translate(-50%')) {
          hasTranslateCenter = true;
        }
      }
      
      // è®¡ç®—å…ƒç´ çš„å·¦ä¸Šè§’ä½ç½®ï¼ˆè€ƒè™‘é”šç‚¹å’Œ transformï¼‰
      let elementLeft, elementTop;
      
      if (hasTranslateCenter) {
        // å¦‚æœå…ƒç´ æœ‰ translate(-50%, -50%)ï¼Œå…ƒç´ ä¸­å¿ƒä¼šå¯¹é½åˆ°ç›®æ ‡ç‚¹
        // æ‰€ä»¥ç›´æ¥è®¾ç½®ç›®æ ‡ç‚¹ä½ç½®ï¼Œtransform ä¼šè‡ªåŠ¨å±…ä¸­
        elementLeft = targetPixelX;
        elementTop = targetPixelY;
      } else {
        // æ­£å¸¸è®¡ç®—ï¼Œè€ƒè™‘é”šç‚¹
        elementLeft = targetPixelX - (elementWidth * anchorX);
        elementTop = targetPixelY - (elementHeight * anchorY);
      }
      
      // åº”ç”¨ä½ç½®
      element.style.left = elementLeft + 'px';
      element.style.top = elementTop + 'px';
      
      // æ ‡è®°å…ƒç´ å·²å®šä½ï¼Œæ˜¾ç¤ºå…ƒç´ 
      element.classList.add('positioned');
    }
    
    // æ›´æ–°æ‰€æœ‰å…ƒç´ ä½ç½®
    function updateAllElementPositions() {
      elementPositions.forEach(config => {
        const elements = document.querySelectorAll(config.selector);
        elements.forEach(element => {
          calculateElementPosition(
            element,
            config.targetX,
            config.targetY,
            config.anchorX,
            config.anchorY
          );
        });
      });
    }
    
    // é˜²æŠ–å‡½æ•°
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // åˆ›å»ºé˜²æŠ–ç‰ˆæœ¬çš„ä½ç½®æ›´æ–°å‡½æ•°
    const debouncedUpdatePositions = debounce(updateAllElementPositions, 100);
    
    // åˆå§‹ä½ç½®è®¡ç®—ï¼ˆå¿«é€Ÿè®¡ç®—ï¼Œä¸ç­‰å¾…å›¾ç‰‡åŠ è½½ï¼‰
    function calculateInitialPositions() {
      // ä½¿ç”¨é…ç½®çš„é»˜è®¤å°ºå¯¸å¿«é€Ÿè®¡ç®—ä½ç½®
      const bgImg = document.querySelector('.bg-img');
      if (bgImg && bgImg.naturalWidth > 0) {
        // å¦‚æœèƒŒæ™¯å›¾å·²åŠ è½½ï¼Œä½¿ç”¨å®é™…å°ºå¯¸
        bgConfig.originalWidth = bgImg.naturalWidth || bgConfig.originalWidth;
        bgConfig.originalHeight = bgImg.naturalHeight || bgConfig.originalHeight;
      }
      // å¦åˆ™ä½¿ç”¨é…ç½®ä¸­çš„é»˜è®¤å°ºå¯¸
      
      // ç«‹å³è®¡ç®—å¹¶æ˜¾ç¤ºå…ƒç´ ä½ç½®
      updateAllElementPositions();
    }
    
    // ç­‰å¾… DOM åŠ è½½å®Œæˆ
    document.addEventListener('DOMContentLoaded', function() {
      // ç«‹å³è®¡ç®—åˆå§‹ä½ç½®ï¼ˆä¸ç­‰å¾…å›¾ç‰‡åŠ è½½ï¼‰
      // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿ DOM å·²æ¸²æŸ“
      requestAnimationFrame(function() {
        setTimeout(calculateInitialPositions, 0);
      });
      
      // å¦‚æœèƒŒæ™¯å›¾ç¨ååŠ è½½å®Œæˆï¼Œæ›´æ–°å°ºå¯¸ï¼ˆä½†ä¸å†é‡æ–°è®¡ç®—ä½ç½®ï¼‰
      const bgImg = document.querySelector('.bg-img');
      if (bgImg && !bgImg.complete) {
        bgImg.addEventListener('load', function() {
          // æ›´æ–°é…ç½®ä¸­çš„å®é™…å°ºå¯¸ï¼Œä¾› resize æ—¶ä½¿ç”¨
          bgConfig.originalWidth = bgImg.naturalWidth || bgConfig.originalWidth;
          bgConfig.originalHeight = bgImg.naturalHeight || bgConfig.originalHeight;
          // å¦‚æœçª—å£å¤§å°å·²æ”¹å˜ï¼Œé‡æ–°è®¡ç®—ä¸€æ¬¡
          if (window.innerWidth !== window.initialWidth || window.innerHeight !== window.initialHeight) {
            debouncedUpdatePositions();
          }
        }, { once: true });
      }
      
      // è®°å½•åˆå§‹çª—å£å°ºå¯¸
      window.initialWidth = window.innerWidth;
      window.initialHeight = window.innerHeight;
      
      // åªåœ¨çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è®¡ç®—ä½ç½®
      window.addEventListener('resize', debouncedUpdatePositions);
    });
  </script>
</body>
</html>

