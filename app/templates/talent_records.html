<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Records</title>
    <style>
        html {
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 18px;
            height: 100vh;
            position: relative;
            overflow-y: auto;
        }
        
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .bg-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        * {
            font-size: inherit;
        }
        
        main {
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 100;
            min-height: calc(100vh - 80px);
        }
        
        h2 {
            font-size: 2.5em;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 
                3px 3px 6px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(220, 20, 60, 0.6),
                0 0 30px rgba(255, 215, 0, 0.4);
            font-weight: bold;
            letter-spacing: 2px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                text-shadow: 
                    3px 3px 6px rgba(0, 0, 0, 0.8),
                    0 0 20px rgba(220, 20, 60, 0.6),
                    0 0 30px rgba(255, 215, 0, 0.4);
            }
            to {
                text-shadow: 
                    3px 3px 6px rgba(0, 0, 0, 0.8),
                    0 0 30px rgba(220, 20, 60, 0.8),
                    0 0 40px rgba(255, 215, 0, 0.6);
            }
        }
        
        table {
            border-collapse: collapse;
            width: 80%;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(220, 20, 60, 0.2);
            font-size: 1.2em;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid rgba(255, 215, 0, 0.6);
            backdrop-filter: blur(10px);
        }
        
        th, td {
            border: 1px solid rgba(139, 0, 0, 0.3);
            padding: 18px;
            text-align: center;
            font-size: 1.2em;
        }
        
        th {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.9), rgba(220, 20, 60, 0.9));
            color: white;
            font-size: 1.4em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
        }
        
        tr:nth-child(even) {
            background: rgba(255, 240, 245, 0.5);
        }
        
        tr:hover {
            background: rgba(255, 215, 0, 0.2);
            transition: background 0.3s ease;
        }
        
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.9), rgba(220, 20, 60, 0.9));
            color: white;
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.3),
                0 0 10px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.95), rgba(255, 20, 147, 0.95));
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #pageInfo {
            font-size: 1.4em;
            font-weight: bold;
            color: #fff;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 10px rgba(255, 215, 0, 0.6);
            padding: 0 15px;
        }
        
        td span {
            font-size: 1.2em;
        }
        
        .pagination-container {
            margin-top: 30px;
            text-align: center;
            font-size: 1.4em;
            position: relative;
            z-index: 100;
        }
        
        .home-btn, .logout-btn {
            position: fixed;
            top: clamp(0.75rem, 2vw, 1rem);
            z-index: 1000;
            color: white;
            text-decoration: none;
            padding: clamp(0.5rem, 1.5vw, 0.625rem) clamp(0.75rem, 2vw, 1rem);
            border: 2px solid rgba(220, 53, 69, 0.6);
            border-radius: clamp(0.5rem, 1.2vw, 0.75rem);
            font-size: clamp(0.875rem, 2vw, 1rem);
            transition: all 0.3s ease;
            font-weight: 600;
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.85), rgba(200, 35, 51, 0.85));
            backdrop-filter: blur(8px);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.4),
                0 0 15px rgba(220, 53, 69, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            width: 15%;
            max-width: 6vw;
            max-height: 6vw;
            min-width: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            white-space: nowrap;
        }
        
        .home-btn {
            right: clamp(7rem, 15vw, 10rem);
        }
        
        .logout-btn {
            right: clamp(1rem, 4vw, 1.25rem);
        }
        
        .home-btn:hover, .logout-btn:hover {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.95), rgba(200, 35, 51, 0.95));
            border-color: rgba(255, 215, 0, 0.8);
            transform: translateY(-2px);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.5),
                0 0 25px rgba(255, 215, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        
        /* 响应式设计 - 大屏幕设备 */
        @media (min-width: 1200px) {
            .home-btn, .logout-btn {
                max-width: 8vw;
                max-height: 8vw;
                font-size: clamp(1rem, 2.2vw, 1.25rem);
                padding: clamp(0.625rem, 1.8vw, 0.75rem) clamp(0.875rem, 2.2vw, 1.25rem);
            }
        }
        
        /* 响应式设计 - 超大屏幕设备 */
        @media (min-width: 2560px) {
            .home-btn, .logout-btn {
                max-width: 10vw;
                max-height: 10vw;
                font-size: clamp(1.125rem, 2.5vw, 1.5rem);
                padding: clamp(0.75rem, 2vw, 1rem) clamp(1rem, 2.5vw, 1.5rem);
            }
        }
    </style>
</head>
<body>
    <div class="bg-container">
        <img src="{{ url_for('static', filename='background/board_no_text.png') }}" alt="Background" class="bg-img">
    </div>
    
    <!-- Home and Logout Buttons -->
    {% if session.username %}
        <a href="{{ url_for('main.draw') }}" class="home-btn">Home</a>
        <a href="{{ url_for('user.logout') }}" class="logout-btn">Logout</a>
    {% endif %}

    <main>
        <h2>Latest Gifts (Pacific Time)</h2>
        <table id="recordsTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Your Draw Records</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination-container">
            <button onclick="prevPage()">Prev</button>
            <span id="pageInfo"></span>
            <button onclick="nextPage()">Next</button>
        </div>

        <!-- JSON data from backend -->
        <script id="records-json" type="application/json">
            {{ records | tojson | safe }}
        </script>

        <script>
            // 防抖函数
            function debounce(func, wait) {
              let timeout;
              return function executedFunction(...args) {
                const later = () => {
                  clearTimeout(timeout);
                  func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
              };
            }
            
            // 确保 home-btn 和 logout-btn 不重叠
            function adjustButtonPositions() {
              const logoutBtn = document.querySelector('.logout-btn');
              const homeBtn = document.querySelector('.home-btn');
              
              if (logoutBtn && homeBtn) {
                // 获取 logout-btn 的位置和宽度
                const logoutRect = logoutBtn.getBoundingClientRect();
                const logoutRight = window.innerWidth - logoutRect.right; // logout-btn 距离右边的距离（px）
                const logoutWidth = logoutRect.width; // logout-btn 的宽度（px）
                
                // 获取 home-btn 的宽度
                const homeBtnRect = homeBtn.getBoundingClientRect();
                const homeBtnWidth = homeBtnRect.width; // home-btn 的宽度（px）
                
                // 计算 home-btn 应该的 right 值（像素）
                // 需要确保 home-btn 的右边缘在 logout-btn 的左边缘左边，并留出间距
                const spacing = 16; // 16px 的间距（约 1rem）
                const homeBtnRight = logoutRight + logoutWidth + spacing;
                
                // 设置 home-btn 的 right 值（使用像素值，更精确）
                homeBtn.style.right = homeBtnRight + 'px';
              }
            }
            
            // 创建防抖版本的按钮位置调整函数
            const debouncedAdjustButtons = debounce(adjustButtonPositions, 100);
            
            const recordList = JSON.parse(document.getElementById('records-json').textContent || '[]');
            const pageSize = 20;
            let currentPage = 1;

            function renderTable() {
                const tbody = document.querySelector("#recordsTable tbody");
                tbody.innerHTML = "";

                const start = (currentPage - 1) * pageSize;
                const end = Math.min(start + pageSize, recordList.length);

                for (let i = start; i < end; i++) {
                    let words = recordList[i].split(/\s+/);

                    // indices: index 4 和 6 标红
                    const redIndices = [5, 7];

                    for (let idx of redIndices) {
                        if (idx < words.length) {
                            // 如果 index 6 的单词是 "yourself"，不变成红色和加粗
                            if (idx === 7 && words[idx].toLowerCase() === 'yourself') {
                                continue;
                            }
                            words[idx] = `<span style="color:red; font-weight:bold; font-size: 1.2em;">${words[idx]}</span>`;
                        }
                    }

                    let coloredText = words.join(" ");

                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${i + 1}</td>
                        <td>${coloredText}</td>
                    `;
                    tbody.appendChild(row);
                }

                document.getElementById("pageInfo").innerText =
                    `Page ${currentPage} / ${Math.ceil(recordList.length / pageSize)}`;
            }

            function prevPage() {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            }

            function nextPage() {
                if (currentPage < Math.ceil(recordList.length / pageSize)) {
                    currentPage++;
                    renderTable();
                }
            }

            renderTable();
            
            // 等待 DOM 加载完成后调整按钮位置
            document.addEventListener('DOMContentLoaded', function() {
              // 立即调整按钮位置
              requestAnimationFrame(function() {
                setTimeout(adjustButtonPositions, 50);
              });
              
              // 窗口大小改变时重新调整按钮位置
              window.addEventListener('resize', debouncedAdjustButtons);
            });
        </script>
    </main>
</body>
</html>